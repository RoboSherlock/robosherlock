sudo: required
dist: trusty

language: cpp

cache: ccache
  directories:
    - $HOME/local/src/mongo-cxx-driver/

services:
  - docker

addons:
  apt:
    packages:
    - automake
    - libicu-dev
    - scons

env:
  global:
    - toolset_branch: master
    - server_type: travis
    - used_modules: check_cache,check_build,code_style_check,check_deb_make
    - remote_shell_script: 'https://raw.githubusercontent.com/shadow-robot/sr-build-tools/$toolset_branch/bin/sr-run-ci-build.sh'

before_script:
- sudo apt-get install -y libxerces-c-dev libapr1-dev mongodb protobuf-compiler --force-yes
- mkdir -p ~/local/src && cd ~/local/src/
- git clone https://github.com/robosherlock/uima-uimacpp.git uimacpp
- cd uimacpp
- ./autogen.sh
- ./configure --without-activemq --with-jdk=/usr/lib/jvm/java-7-openjdk-amd64/include --prefix=/usr/local --with-icu=/usr
- make
- sudo make install
- ls /usr/local/lib
- cd ~/local/src/
- git clone https://github.com/mongodb/mongo-cxx-driver.git
- cd mongo-cxx-driver/
- git checkout 26compat
- sudo scons --full --use-system-boost --prefix=/usr/local --ssl --sharedclient install-mongoclient
- ls /usr/local/lib
- echo "export APR_HOME=/usr" >> ~/.bashrc
- echo "export ICU_HOME=/usr" >> ~/.bashrc
- echo "export XERCES_HOME=/usr" >> ~/.bashrc
- echo "export LD_LIBRARY_PATH=/usr/local/lib:${LD_LIBRARY_PATH}" >> ~/.bashrc
- . ~/.bashrc

script:
  - curl -s "$( echo "$remote_shell_script" | sed 's/#/%23/g' )" | bash -x /dev/stdin "$toolset_branch" $server_type $used_modules
